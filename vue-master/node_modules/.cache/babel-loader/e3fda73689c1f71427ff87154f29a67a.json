{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport request from \"@/utils/request\";\nvar socket;\nexport default {\n  name: \"Home\",\n  data: function data() {\n    return {\n      dialogFormVisible: false,\n      // user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n      circleUrl: 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n      user: {},\n      isCollapse: false,\n      users: [],\n      chatUser: '',\n      text: \"\",\n      messages: [],\n      content: '',\n      user1: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      person: {}\n    };\n  },\n  created: function created() {\n    var _this2 = this;\n\n    this.init();\n\n    var _loop = function _loop(i) {\n      _this2.request.get(\"/user/\" + _this2.users[i].username).then(function (res) {\n        if (res.code === '200') {\n          _this2.users[i].avatarUrl = res.data.avatarUrl;\n          console.log(_this2.users + \"1111111111111111111111\");\n        }\n      });\n    };\n\n    for (var i = 0; i < this.users.length; i++) {\n      _loop(i);\n    }\n  },\n  methods: {\n    handleFileUploadSuccess: function handleFileUploadSuccess() {},\n    toData1: function toData1() {\n      if (this.user.role == 1) {\n        this.$router.push('/role');\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData2: function toData2() {\n      if (this.user.role == 1) {\n        this.$router.push('/role');\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n\n      this.$router.push('/data');\n    },\n    toData3: function toData3() {\n      this.$router.push('/file');\n    },\n    toData4: function toData4() {\n      this.dialogFormVisible = true;\n    },\n    toData5: function toData5() {\n      this.$router.push('/china');\n    },\n    toData6: function toData6() {\n      this.$router.push('/menu');\n    },\n    send: function send() {\n      if (!this.chatUser) {\n        this.$message({\n          type: 'warning',\n          message: \"请选择聊天对象\"\n        });\n        return;\n      }\n\n      if (!this.text) {\n        this.$message({\n          type: 'warning',\n          message: \"请输入内容\"\n        });\n      } else {\n        if (typeof WebSocket == \"undefined\") {\n          console.log(\"您的浏览器不支持WebSocket\");\n        } else {\n          console.log(\"您的浏览器支持WebSocket\"); // 组装待发送的消息 json\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\n\n          var message = {\n            from: this.user.username,\n            to: this.chatUser,\n            text: this.text\n          };\n          socket.send(JSON.stringify(message)); // 将组装好的json发送给服务端，由服务端进行转发\n\n          this.messages.push({\n            user: this.user.username,\n            text: this.text\n          }); // 构建消息内容，本人消息\n\n          this.createContent(null, this.user.username, this.text);\n          this.text = '';\n        }\n      }\n    },\n    createContent: function createContent(remoteUser, nowUser, text) {\n      // 这个方法是用来将 json的聊天消息数据转换成 html的。\n      var html; // 当前用户消息\n\n      if (nowUser) {\n        // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" + \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: right; padding-right: 10px\\\">\\n\" + \"    <div class=\\\"tip left\\\">\" + text + \"</div>\\n\" + \"  </div>\\n\" + \"  <div class=\\\"el-col el-col-2\\\">\\n\" + \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" + \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" + \"  </span>\\n\" + \"  </div>\\n\" + \"</div>\";\n      } else if (remoteUser) {\n        // remoteUser表示远程用户聊天消息，蓝色的气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" + \"  <div class=\\\"el-col el-col-2\\\" style=\\\"text-align: right\\\">\\n\" + \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" + \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" + \"  </span>\\n\" + \"  </div>\\n\" + \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: left; padding-left: 10px\\\">\\n\" + \"    <div class=\\\"tip right\\\">\" + text + \"</div>\\n\" + \"  </div>\\n\" + \"</div>\";\n      }\n\n      console.log(html);\n      this.content += html;\n    },\n    init: function init() {\n      this.user = localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {};\n      var username = this.user.username;\n\n      var _this = this;\n\n      if (typeof WebSocket == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\");\n        var socketUrl = \"ws://localhost:9090/imserver/\" + username;\n\n        if (socket != null) {\n          socket.close();\n          socket = null;\n        } // 开启一个websocket服务\n\n\n        socket = new WebSocket(socketUrl); //打开事件\n\n        socket.onopen = function () {\n          console.log(\"websocket已打开\");\n        }; //  浏览器端收消息，获得从服务端发送过来的文本消息\n\n\n        socket.onmessage = function (msg) {\n          console.log(\"收到数据====\" + msg.data);\n          var data = JSON.parse(msg.data); // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\n\n          if (data.users) {\n            // 获取在线人员信息\n            _this.users = data.users.filter(function (user) {\n              return user.username !== username;\n            }); // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\n          } else {\n            // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\n            //  // {\"from\": \"zhang\", \"text\": \"hello\"}\n            if (data.from === _this.chatUser) {\n              _this.messages.push(data); // 构建消息内容\n\n\n              _this.createContent(data.from, null, data.text);\n            }\n          }\n        }; //关闭事件\n\n\n        socket.onclose = function () {\n          console.log(\"websocket已关闭\");\n        }; //发生了错误事件\n\n\n        socket.onerror = function () {\n          console.log(\"websocket发生了错误\");\n        };\n      }\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuJA;AACA;AACA;AACAA,cADA;AAEAC,MAFA,kBAEA;AACA;AACAC,8BADA;AAEA;AACAC,sFAHA;AAIAC,cAJA;AAKAC,uBALA;AAMAC,eANA;AAOAC,kBAPA;AAQAC,cARA;AASAC,kBATA;AAUAC,iBAVA;AAWAC,yFAXA;AAYAC;AAZA;AAcA,GAjBA;AAkBAC,SAlBA,qBAkBA;AAAA;;AACA;;AADA,+BAEAC,CAFA;AAGA;AACA;AACA;AACAC;AACA;AACA,OALA;AAHA;;AAEA;AAAA;AAOA;AACA,GA5BA;AA6BAC;AACAC,2BADA,qCACA,CAEA,CAHA;AAIAC,WAJA,qBAIA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAVA;AAWAC,WAXA,qBAWA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;;AACA;AACA,KAlBA;AAmBAC,WAnBA,qBAmBA;AACA;AACA,KArBA;AAsBAC,WAtBA,qBAsBA;AACA;AACA,KAxBA;AAyBAC,WAzBA,qBAyBA;AACA;AACA,KA3BA;AA4BAC,WA5BA,qBA4BA;AACA;AACA,KA9BA;AA+BAC,QA/BA,kBA+BA;AACA;AACA;AAAAC;AAAAC;AAAA;AACA;AACA;;AACA;AACA;AAAAD;AAAAC;AAAA;AACA,OAFA,MAEA;AACA;AACAX;AACA,SAFA,MAEA;AACAA,0CADA,CAEA;AACA;;AACA;AAAAY;AAAAC;AAAApB;AAAA;AACAqB,+CALA,CAKA;;AACA;AAAAzB;AAAAI;AAAA,aANA,CAOA;;AACA;AACA;AACA;AACA;AACA,KArDA;AAsDAsB,iBAtDA,yBAsDAC,UAtDA,EAsDAC,OAtDA,EAsDAxB,IAtDA,EAsDA;AAAA;AACA,eADA,CAEA;;AACA;AAAA;AACAyB,qEACA,uFADA,GAEA,8BAFA,GAEAzB,IAFA,GAEA,UAFA,GAGA,YAHA,GAIA,qCAJA,GAKA,0GALA,GAMA,sHANA,GAOA,aAPA,GAQA,YARA,GASA,QATA;AAUA,OAXA,MAWA;AAAA;AACAyB,qEACA,iEADA,GAEA,0GAFA,GAGA,sHAHA,GAIA,aAJA,GAKA,YALA,GAMA,qFANA,GAOA,+BAPA,GAOAzB,IAPA,GAOA,UAPA,GAQA,YARA,GASA,QATA;AAUA;;AACAO;AACA;AACA,KAlFA;AAmFAmB,QAnFA,kBAmFA;AACA;AACA;;AACA;;AACA;AACAnB;AACA,OAFA,MAEA;AACAA;AACA;;AACA;AACAc;AACAA;AACA,SANA,CAOA;;;AACAA,0CARA,CASA;;AACAA;AACAd;AACA,SAFA,CAVA,CAaA;;;AACAc;AACAd;AACA,0CAFA,CAEA;;AACA;AAAA;AAEAoB;AAAA;AAAA,eAFA,CAGA;AACA,WAJA,MAIA;AAEA;AACA;AACA;AACAA,wCADA,CAEA;;;AACAA;AACA;AACA;AACA,SAjBA,CAdA,CAgCA;;;AACAN;AACAd;AACA,SAFA,CAjCA,CAoCA;;;AACAc;AACAd;AACA,SAFA;AAGA;AACA;AAlIA;AA7BA","names":["name","data","dialogFormVisible","circleUrl","user","isCollapse","users","chatUser","text","messages","content","user1","person","created","i","console","methods","handleFileUploadSuccess","toData1","toData2","toData3","toData4","toData5","toData6","send","type","message","from","to","socket","createContent","remoteUser","nowUser","html","init","_this"],"sourceRoot":"src/views","sources":["Home.vue"],"sourcesContent":["<template>\n  <div>\n    <el-row style=\"margin-bottom: 25px\">\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: #409EFF;width: 419px;height: 150px;border-radius: 3%\">\n          <h2 style=\"margin: 0\">权限管理</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-edit\" style=\"position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"primary\" plain style=\"opacity:0.5;position: relative;\n          bottom: -19px;left:-20px;width: 429px\" @click=\"toData1\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: #67C23A;width: 419px;height: 150px;border-radius: 3%\">\n          <h2 style=\"margin: 0\">数据报表</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-s-data\" style=\"position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"success\" plain style=\"opacity:0.5;position: relative;\n          bottom: -19px;left:-20px;width: 429px\" @click=\"toData2\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: #E6A23C;width: 419px;height: 150px;border-radius: 3%\">\n          <h2 style=\"margin: 0\">文件管理</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-collection\" style=\"position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"warning\" @click=\"toData3\" plain style=\"opacity:0.5;position: relative;\n          bottom: -19px;left:-20px;width: 429px\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n\n        </el-card>\n      </el-col>\n    </el-row>\n    <el-row>\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: #F56C6C;width: 419px;height: 149px;border-radius: 3%\">\n          <h2 style=\"margin: 0\">企业简聊</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-chat-dot-round\" style=\"position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"danger\" plain style=\"opacity:0.5;position: relative;\n          bottom: -20px;left:-20px;width: 429px\" @click=\"toData4\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: blue;width: 419px;height: 149px;border-radius: 3%\">\n          <h2 style=\"margin: 0\">公司地址</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-map-location\" style=\"position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"primary\" plain style=\"opacity:0.5;position: relative;\n          bottom: -19px;left:-20px;width: 429px\" @click=\"toData5\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\" >\n        <el-card style=\"background-color: #303133;width: 419px;height: 149px;border-radius: 3%\">\n          <h2 style=\"margin: 0;color: black\">系统设置</h2>\n          <div style=\"margin: 0;margin-top: 5px;color: black\">Faster and easier</div>\n          <i class=\"el-icon-s-tools\" style=\"color:black;position:relative;right: -350px;top:-20px;font-size: 30px\"></i>\n          <el-button type=\"info\" @click=\"toData6\"  plain style=\"opacity:0.5;position: relative;\n          bottom: -19px;left:-20px;width: 429px\">&nbsp;&nbsp;&nbsp;<i class=\"el-icon-position\" style=\"font-size: 15px\"></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button>\n        </el-card>\n      </el-col>\n    </el-row>\n    <el-dialog title=\"\" :visible.sync=\"dialogFormVisible\" width=\"64%\"  style=\"\n    padding: 0;margin: 0;height: 724px;overflow-y: hidden;\n\n\" >\n      <div style=\"position: relative;top: -60px\">\n        <el-row>\n          <el-col :span=\"4\">\n            <el-card style=\"width: 180px; height: 603px; color: #333;\n        background-color: #303133;opacity: 0.9;\n        position: relative;\n        left: -26px;\n        top: -1px;\n        \">\n<!--              <img v-if=\"user1.avatarUrl\" :src=\"user1.avatarUrl\"  class=\"avatar\" width=\"40px\" height=\"40px\"-->\n<!--                   style=\"padding: 0px;position: relative;top: -16px;left: -7px\">-->\n              <span style=\"color: #133ecb;font-size: 18px;position: relative;padding: 5px 0;right: -10px;left: -5px;\n              top: -15px;\n\"><el-input style=\"width: 150px\" placeholder=\"请输入名称\" suffix-icon=\"el-icon-search\" ></el-input>\n              </span>\n              <div style=\"padding-bottom: 10px;\n          position: relative;top: -15px;left: -13px;margin-bottom: 3px;\n          border-bottom: 2px solid rgba(1,1,1,0.63);width:220px;color: #0d40e7;font-weight: bolder\"><span style=\"font-size: 12px\"></span></div>\n              <div style=\"padding: 1px 0;background-color: #EBEEF5;margin:0;opacity: 1;\n              width: 200px;position:relative;left: -15px;top: -18px\" v-for=\"user in users\" :key=\"user.username\"\n                   @click=\"chatUser = user.username\"\n              >\n                <img v-if=\"user1.avatarUrl\" :src=\"user1.avatarUrl\"\n                     class=\"avatar\" width=\"50px\" height=\"50px\" alt=\"\"\n                     style=\"border: 1px solid white;position: relative;top: 0px;left: 0px;margin: 0\">\n                <span style=\"color: rgba(1,1,1,0.63);position: relative;top: -30px;right: -10px;\n\" >{{ user.username }}</span>\n                <div style=\"border-bottom: 1px solid black\">\n\n                </div>\n<!--                <i class=\"el-icon-chat-dot-round\" style=\"margin-left: 10px;position: relative;-->\n<!--                top: -32px;-->\n<!--                 font-size: 16px; cursor: pointer;color: #0b31ee\"-->\n<!--                   @click=\"chatUser = user.username\"></i>-->\n<!--                <span style=\"color: #09de0d;font-size: 12px; margin-left: 5px\" v-if=\"user.username === chatUser\"></span>-->\n              </div>\n            </el-card>\n          </el-col>\n          <el-col :span=\"20\">\n            <div style=\"width: 800px; margin: 0 auto; background-color: white;\n                    border-radius: 5px; box-shadow: 0 0 10px #ccc\">\n              <div style=\"text-align: center; line-height: 50px;font-size: 20px\">\n                 {{ chatUser }}\n                <el-button style=\"opacity: 0.1\">\n                </el-button>\n              </div>\n              <div style=\"height: 350px; overflow:auto; border-top: 1px solid #ccc;background-color: #E4E7ED\" v-html=\"content\"></div>\n              <div style=\"height: 200px\">\n            <textarea v-model=\"text\" style=\"overflow-y: hidden;height: 160px;\n            width: 755px; padding: 20px; border: none; border-top: 1px solid #ccc;\n             border-bottom: 1px solid #ccc; outline: none;font-size: 25px\" class=\"el-textarea_inner\">\n            </textarea>\n                <div style=\"text-align: right; padding-right: 10px\">\n                  <el-upload action=\"http://localhost:9090/file/upload\" :show-file-list=\"false\" :on-success=\"handleFileUploadSuccess\" style=\"display: inline-block\">\n                    <el-button type=\"primary\" size=\"mini\"  plain\n                               style=\"position: relative;top: -42px;left: -1px;font-size: 18px\">\n                      上传文件\n                    </el-button>\n                  </el-upload>\n                  <el-button type=\"success\" size=\"mini\" @click=\"send\" plain\n                             style=\"position: relative;top: -43px;right: -1px;font-size: 18px\">\n                    发送</el-button>\n                  <el-button type=\"danger\" size=\"mini\" @click=\"dialogFormVisible = false\" plain\n                             style=\"position: relative;top: -43px;right: -1px;font-size: 18px\">\n                    关闭</el-button>\n                </div>\n              </div>\n            </div>\n          </el-col>\n        </el-row>\n      </div>\n    </el-dialog>\n  </div>\n\n</template>\n\n<script>\nimport request from \"@/utils/request\";\nlet socket;\nexport default {\n  name: \"Home\",\n  data(){\n    return {\n      dialogFormVisible:false,\n      // user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n      circleUrl: 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n      user: {},\n      isCollapse: false,\n      users: [],\n      chatUser: '',\n      text: \"\",\n      messages: [],\n      content: '',\n      user1: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      person:{}\n    }\n  },\n  created() {\n    this.init()\n    for (let i = 0; i < this.users.length; i++) {\n      this.request.get(\"/user/\"+ this.users[i].username).then(res =>{\n        if (res.code === '200'){\n          this.users[i].avatarUrl = res.data.avatarUrl\n          console.log(this.users+\"1111111111111111111111\");\n        }\n      })\n    }\n  },\n  methods:{\n    handleFileUploadSuccess(){\n\n    },\n    toData1(){\n      if(this.user.role == 1){\n        this.$router.push('/role');\n      }else{\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData2(){\n      if(this.user.role == 1){\n        this.$router.push('/role');\n      }else{\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n      this.$router.push('/data')\n    },\n    toData3(){\n      this.$router.push('/file')\n    },\n    toData4(){\n      this.dialogFormVisible = true;\n    },\n    toData5(){\n      this.$router.push('/china')\n    },\n    toData6(){\n      this.$router.push('/menu')\n    },\n    send() {\n      if (!this.chatUser) {\n        this.$message({type: 'warning', message: \"请选择聊天对象\"})\n        return;\n      }\n      if (!this.text) {\n        this.$message({type: 'warning', message: \"请输入内容\"})\n      } else {\n        if (typeof (WebSocket) == \"undefined\") {\n          console.log(\"您的浏览器不支持WebSocket\");\n        } else {\n          console.log(\"您的浏览器支持WebSocket\");\n          // 组装待发送的消息 json\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\n          let message = {from: this.user.username, to: this.chatUser, text: this.text}\n          socket.send(JSON.stringify(message));  // 将组装好的json发送给服务端，由服务端进行转发\n          this.messages.push({user: this.user.username, text: this.text})\n          // 构建消息内容，本人消息\n          this.createContent(null, this.user.username, this.text)\n          this.text = '';\n        }\n      }\n    },\n    createContent(remoteUser, nowUser, text) {  // 这个方法是用来将 json的聊天消息数据转换成 html的。\n      let html\n      // 当前用户消息\n      if (nowUser) { // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" +\n            \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: right; padding-right: 10px\\\">\\n\" +\n            \"    <div class=\\\"tip left\\\">\" + text + \"</div>\\n\" +\n            \"  </div>\\n\" +\n            \"  <div class=\\\"el-col el-col-2\\\">\\n\" +\n            \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" +\n            \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" +\n            \"  </span>\\n\" +\n            \"  </div>\\n\" +\n            \"</div>\";\n      } else if (remoteUser) {   // remoteUser表示远程用户聊天消息，蓝色的气泡\n        html = \"<div class=\\\"el-row\\\" style=\\\"padding: 5px 0\\\">\\n\" +\n            \"  <div class=\\\"el-col el-col-2\\\" style=\\\"text-align: right\\\">\\n\" +\n            \"  <span class=\\\"el-avatar el-avatar--circle\\\" style=\\\"height: 40px; width: 40px; line-height: 40px;\\\">\\n\" +\n            \"    <img src=\\\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\\\" style=\\\"object-fit: cover;\\\">\\n\" +\n            \"  </span>\\n\" +\n            \"  </div>\\n\" +\n            \"  <div class=\\\"el-col el-col-22\\\" style=\\\"text-align: left; padding-left: 10px\\\">\\n\" +\n            \"    <div class=\\\"tip right\\\">\" + text + \"</div>\\n\" +\n            \"  </div>\\n\" +\n            \"</div>\";\n      }\n      console.log(html)\n      this.content += html;\n    },\n    init() {\n      this.user = localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n      let username = this.user.username;\n      let _this = this;\n      if (typeof (WebSocket) == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\");\n        let socketUrl = \"ws://localhost:9090/imserver/\" + username;\n        if (socket != null) {\n          socket.close();\n          socket = null;\n        }\n        // 开启一个websocket服务\n        socket = new WebSocket(socketUrl);\n        //打开事件\n        socket.onopen = function () {\n          console.log(\"websocket已打开\");\n        };\n        //  浏览器端收消息，获得从服务端发送过来的文本消息\n        socket.onmessage = function (msg) {\n          console.log(\"收到数据====\" + msg.data)\n          let data = JSON.parse(msg.data)  // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\n          if (data.users) {  // 获取在线人员信息\n\n            _this.users = data.users.filter(user => user.username !== username)\n            // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\n          } else {\n\n            // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\n            //  // {\"from\": \"zhang\", \"text\": \"hello\"}\n            if (data.from === _this.chatUser) {\n              _this.messages.push(data)\n              // 构建消息内容\n              _this.createContent(data.from, null, data.text)\n            }\n          }\n        };\n        //关闭事件\n        socket.onclose = function () {\n          console.log(\"websocket已关闭\");\n        };\n        //发生了错误事件\n        socket.onerror = function () {\n          console.log(\"websocket发生了错误\");\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style >\n.tip {\n  color: white;\n  text-align: center;\n  border-radius: 10px;\n  font-family: sans-serif;\n  padding: 10px;\n  width:auto;\n  display:inline-block !important;\n  display:inline;\n}\n.right {\n  background-color: deepskyblue;\n}\n.left {\n  background-color: forestgreen;\n}\n.el-textarea_inner{\n  resize: none;\n}\n</style>"]},"metadata":{},"sourceType":"module"}
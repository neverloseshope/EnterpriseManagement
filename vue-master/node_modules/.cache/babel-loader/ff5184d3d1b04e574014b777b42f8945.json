{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport request from \"@/utils/request\";\nvar socket;\nexport default {\n  name: \"Home\",\n  data: function data() {\n    return {\n      dialogFormVisible: false,\n      // user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n      circleUrl: \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\",\n      user: {},\n      isCollapse: false,\n      users: [],\n      chatUser: \"\",\n      text: \"\",\n      messages: [],\n      content: \"\",\n      user1: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      person: {}\n    };\n  },\n  created: function created() {\n    var _this2 = this;\n\n    this.init();\n\n    var _loop = function _loop(i) {\n      _this2.request.get(\"/user/\" + _this2.users[i].username).then(function (res) {\n        if (res.code === \"200\") {\n          _this2.users[i].avatarUrl = res.data.avatarUrl;\n          console.log(_this2.users + \"1111111111111111111111\");\n        }\n      });\n    };\n\n    for (var i = 0; i < this.users.length; i++) {\n      _loop(i);\n    }\n  },\n  methods: {\n    handleFileUploadSuccess: function handleFileUploadSuccess() {},\n    toData1: function toData1() {\n      if (this.user.role == 1) {\n        this.$router.push(\"/role\");\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData2: function toData2() {\n      if (this.user.role == 1 || this.user.role == 5) {\n        this.$router.push(\"/data\");\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData3: function toData3() {\n      this.$router.push(\"/file\");\n    },\n    toData4: function toData4() {\n      this.dialogFormVisible = true;\n    },\n    toData5: function toData5() {\n      this.$router.push(\"/china\");\n    },\n    toData6: function toData6() {\n      this.$router.push(\"/menu\");\n    },\n    send: function send() {\n      if (!this.chatUser) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择聊天对象\"\n        });\n        return;\n      }\n\n      if (!this.text) {\n        this.$message({\n          type: \"warning\",\n          message: \"请输入内容\"\n        });\n      } else {\n        if (typeof WebSocket == \"undefined\") {\n          console.log(\"您的浏览器不支持WebSocket\");\n        } else {\n          console.log(\"您的浏览器支持WebSocket\"); // 组装待发送的消息 json\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\n\n          var message = {\n            from: this.user.username,\n            to: this.chatUser,\n            text: this.text\n          };\n          socket.send(JSON.stringify(message)); // 将组装好的json发送给服务端，由服务端进行转发\n\n          this.messages.push({\n            user: this.user.username,\n            text: this.text\n          }); // 构建消息内容，本人消息\n\n          this.createContent(null, this.user.username, this.text);\n          this.text = \"\";\n        }\n      }\n    },\n    createContent: function createContent(remoteUser, nowUser, text) {\n      // 这个方法是用来将 json的聊天消息数据转换成 html的。\n      var html; // 当前用户消息\n\n      if (nowUser) {\n        // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\n        html = '<div class=\"el-row\" style=\"padding: 5px 0\">\\n' + '  <div class=\"el-col el-col-22\" style=\"text-align: right; padding-right: 10px\">\\n' + '    <div class=\"tip left\">' + text + \"</div>\\n\" + \"  </div>\\n\" + '  <div class=\"el-col el-col-2\">\\n' + '  <span class=\"el-avatar el-avatar--circle\" style=\"height: 40px; width: 40px; line-height: 40px;\">\\n' + '    <img src=\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\" style=\"object-fit: cover;\">\\n' + \"  </span>\\n\" + \"  </div>\\n\" + \"</div>\";\n      } else if (remoteUser) {\n        // remoteUser表示远程用户聊天消息，蓝色的气泡\n        html = '<div class=\"el-row\" style=\"padding: 5px 0\">\\n' + '  <div class=\"el-col el-col-2\" style=\"text-align: right\">\\n' + '  <span class=\"el-avatar el-avatar--circle\" style=\"height: 40px; width: 40px; line-height: 40px;\">\\n' + '    <img src=\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\" style=\"object-fit: cover;\">\\n' + \"  </span>\\n\" + \"  </div>\\n\" + '  <div class=\"el-col el-col-22\" style=\"text-align: left; padding-left: 10px\">\\n' + '    <div class=\"tip right\">' + text + \"</div>\\n\" + \"  </div>\\n\" + \"</div>\";\n      }\n\n      console.log(html);\n      this.content += html;\n    },\n    init: function init() {\n      this.user = localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {};\n      var username = this.user.username;\n\n      var _this = this;\n\n      if (typeof WebSocket == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\");\n        var socketUrl = \"ws://localhost:9090/imserver/\" + username;\n\n        if (socket != null) {\n          socket.close();\n          socket = null;\n        } // 开启一个websocket服务\n\n\n        socket = new WebSocket(socketUrl); //打开事件\n\n        socket.onopen = function () {\n          console.log(\"websocket已打开\");\n        }; //  浏览器端收消息，获得从服务端发送过来的文本消息\n\n\n        socket.onmessage = function (msg) {\n          console.log(\"收到数据====\" + msg.data);\n          var data = JSON.parse(msg.data); // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\n\n          if (data.users) {\n            // 获取在线人员信息\n            _this.users = data.users.filter(function (user) {\n              return user.username !== username;\n            }); // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\n          } else {\n            // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\n            //  // {\"from\": \"zhang\", \"text\": \"hello\"}\n            if (data.from === _this.chatUser) {\n              _this.messages.push(data); // 构建消息内容\n\n\n              _this.createContent(data.from, null, data.text);\n            }\n          }\n        }; //关闭事件\n\n\n        socket.onclose = function () {\n          console.log(\"websocket已关闭\");\n        }; //发生了错误事件\n\n\n        socket.onerror = function () {\n          console.log(\"websocket发生了错误\");\n        };\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["name","data","dialogFormVisible","circleUrl","user","isCollapse","users","chatUser","text","messages","content","user1","JSON","person","created","i","console","methods","handleFileUploadSuccess","toData1","toData2","toData3","toData4","toData5","toData6","send","type","message","from","to","socket","createContent","remoteUser","nowUser","html","init","_this"],"sourceRoot":"src/views","sources":["Home.vue"],"sourcesContent":["<template>\n  <div>\n    <el-row style=\"margin-bottom: 25px\">\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: #409eff;\n            width: 419px;\n            height: 150px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0\">权限管理</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-edit\"\n            style=\"\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"primary\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -19px;\n              left: -20px;\n              width: 429px;\n            \"\n            @click=\"toData1\"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: #67c23a;\n            width: 419px;\n            height: 150px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0\">数据报表</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-s-data\"\n            style=\"\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"success\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -19px;\n              left: -20px;\n              width: 429px;\n            \"\n            @click=\"toData2\"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: #e6a23c;\n            width: 419px;\n            height: 150px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0\">文件管理</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-collection\"\n            style=\"\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"warning\"\n            @click=\"toData3\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -19px;\n              left: -20px;\n              width: 429px;\n            \"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n    </el-row>\n    <el-row>\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: #f56c6c;\n            width: 419px;\n            height: 149px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0\">企业简聊</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-chat-dot-round\"\n            style=\"\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"danger\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -20px;\n              left: -20px;\n              width: 429px;\n            \"\n            @click=\"toData4\"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: blue;\n            width: 419px;\n            height: 149px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0\">公司地址</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-map-location\"\n            style=\"\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"primary\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -19px;\n              left: -20px;\n              width: 429px;\n            \"\n            @click=\"toData5\"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-card\n          style=\"\n            background-color: #303133;\n            width: 419px;\n            height: 149px;\n            border-radius: 3%;\n          \"\n        >\n          <h2 style=\"margin: 0; color: black\">系统设置</h2>\n          <div style=\"margin: 0; margin-top: 5px; color: black\">\n            Faster and easier\n          </div>\n          <i\n            class=\"el-icon-s-tools\"\n            style=\"\n              color: black;\n              position: relative;\n              right: -350px;\n              top: -20px;\n              font-size: 30px;\n            \"\n          ></i>\n          <el-button\n            type=\"info\"\n            @click=\"toData6\"\n            plain\n            style=\"\n              opacity: 0.5;\n              position: relative;\n              bottom: -19px;\n              left: -20px;\n              width: 429px;\n            \"\n            >&nbsp;&nbsp;&nbsp;<i\n              class=\"el-icon-position\"\n              style=\"font-size: 15px\"\n            ></i>\n            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</el-button\n          >\n        </el-card>\n      </el-col>\n    </el-row>\n    <el-dialog\n      title=\"\"\n      :visible.sync=\"dialogFormVisible\"\n      width=\"64%\"\n      style=\"padding: 0; margin: 0; height: 724px; overflow-y: hidden\"\n    >\n      <div style=\"position: relative; top: -60px\">\n        <el-row>\n          <el-col :span=\"4\">\n            <el-card\n              style=\"\n                width: 180px;\n                height: 603px;\n                color: #333;\n                background-color: #303133;\n                opacity: 0.9;\n                position: relative;\n                left: -26px;\n                top: -1px;\n              \"\n            >\n              <!--              <img v-if=\"user1.avatarUrl\" :src=\"user1.avatarUrl\"  class=\"avatar\" width=\"40px\" height=\"40px\"-->\n              <!--                   style=\"padding: 0px;position: relative;top: -16px;left: -7px\">-->\n              <span\n                style=\"\n                  color: #133ecb;\n                  font-size: 18px;\n                  position: relative;\n                  padding: 5px 0;\n                  right: -10px;\n                  left: -5px;\n                  top: -15px;\n                \"\n                ><el-input\n                  style=\"width: 150px\"\n                  placeholder=\"请输入名称\"\n                  suffix-icon=\"el-icon-search\"\n                ></el-input>\n              </span>\n              <div\n                style=\"\n                  padding-bottom: 10px;\n                  position: relative;\n                  top: -15px;\n                  left: -13px;\n                  margin-bottom: 3px;\n                  border-bottom: 2px solid rgba(1, 1, 1, 0.63);\n                  width: 220px;\n                  color: #0d40e7;\n                  font-weight: bolder;\n                \"\n              >\n                <span style=\"font-size: 12px\"></span>\n              </div>\n              <div\n                style=\"\n                  padding: 1px 0;\n                  background-color: #ebeef5;\n                  margin: 0;\n                  opacity: 1;\n                  width: 200px;\n                  position: relative;\n                  left: -15px;\n                  top: -18px;\n                \"\n                v-for=\"user in users\"\n                :key=\"user.username\"\n                @click=\"chatUser = user.username\"\n              >\n                <img\n                  v-if=\"user1.avatarUrl\"\n                  :src=\"user1.avatarUrl\"\n                  class=\"avatar\"\n                  width=\"50px\"\n                  height=\"50px\"\n                  alt=\"\"\n                  style=\"\n                    border: 1px solid white;\n                    position: relative;\n                    top: 0px;\n                    left: 0px;\n                    margin: 0;\n                  \"\n                />\n                <span\n                  style=\"\n                    color: rgba(1, 1, 1, 0.63);\n                    position: relative;\n                    top: -30px;\n                    right: -10px;\n                  \"\n                  >{{ user.username }}</span\n                >\n                <div style=\"border-bottom: 1px solid black\"></div>\n                <!--                <i class=\"el-icon-chat-dot-round\" style=\"margin-left: 10px;position: relative;-->\n                <!--                top: -32px;-->\n                <!--                 font-size: 16px; cursor: pointer;color: #0b31ee\"-->\n                <!--                   @click=\"chatUser = user.username\"></i>-->\n                <!--                <span style=\"color: #09de0d;font-size: 12px; margin-left: 5px\" v-if=\"user.username === chatUser\"></span>-->\n              </div>\n            </el-card>\n          </el-col>\n          <el-col :span=\"20\">\n            <div\n              style=\"\n                width: 800px;\n                margin: 0 auto;\n                background-color: white;\n                border-radius: 5px;\n                box-shadow: 0 0 10px #ccc;\n              \"\n            >\n              <div\n                style=\"text-align: center; line-height: 50px; font-size: 20px\"\n              >\n                {{ chatUser }}\n                <el-button style=\"opacity: 0.1\"> </el-button>\n              </div>\n              <div\n                style=\"\n                  height: 350px;\n                  overflow: auto;\n                  border-top: 1px solid #ccc;\n                  background-color: #e4e7ed;\n                \"\n                v-html=\"content\"\n              ></div>\n              <div style=\"height: 200px\">\n                <textarea\n                  v-model=\"text\"\n                  style=\"\n                    overflow-y: hidden;\n                    height: 160px;\n                    width: 755px;\n                    padding: 20px;\n                    border: none;\n                    border-top: 1px solid #ccc;\n                    border-bottom: 1px solid #ccc;\n                    outline: none;\n                    font-size: 25px;\n                  \"\n                  class=\"el-textarea_inner\"\n                >\n                </textarea>\n                <div style=\"text-align: right; padding-right: 10px\">\n                  <el-upload\n                    action=\"http://localhost:9090/file/upload\"\n                    :show-file-list=\"false\"\n                    :on-success=\"handleFileUploadSuccess\"\n                    style=\"display: inline-block\"\n                  >\n                    <el-button\n                      type=\"primary\"\n                      size=\"mini\"\n                      plain\n                      style=\"\n                        position: relative;\n                        top: -42px;\n                        left: -1px;\n                        font-size: 18px;\n                      \"\n                    >\n                      上传文件\n                    </el-button>\n                  </el-upload>\n                  <el-button\n                    type=\"success\"\n                    size=\"mini\"\n                    @click=\"send\"\n                    plain\n                    style=\"\n                      position: relative;\n                      top: -43px;\n                      right: -1px;\n                      font-size: 18px;\n                    \"\n                  >\n                    发送</el-button\n                  >\n                  <el-button\n                    type=\"danger\"\n                    size=\"mini\"\n                    @click=\"dialogFormVisible = false\"\n                    plain\n                    style=\"\n                      position: relative;\n                      top: -43px;\n                      right: -1px;\n                      font-size: 18px;\n                    \"\n                  >\n                    关闭</el-button\n                  >\n                </div>\n              </div>\n            </div>\n          </el-col>\n        </el-row>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport request from \"@/utils/request\";\nlet socket;\nexport default {\n  name: \"Home\",\n  data() {\n    return {\n      dialogFormVisible: false,\n      // user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {}\n      circleUrl:\n        \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\",\n      user: {},\n      isCollapse: false,\n      users: [],\n      chatUser: \"\",\n      text: \"\",\n      messages: [],\n      content: \"\",\n      user1: localStorage.getItem(\"user\")\n        ? JSON.parse(localStorage.getItem(\"user\"))\n        : {},\n      person: {},\n    };\n  },\n  created() {\n    this.init();\n    for (let i = 0; i < this.users.length; i++) {\n      this.request.get(\"/user/\" + this.users[i].username).then((res) => {\n        if (res.code === \"200\") {\n          this.users[i].avatarUrl = res.data.avatarUrl;\n          console.log(this.users + \"1111111111111111111111\");\n        }\n      });\n    }\n  },\n  methods: {\n    handleFileUploadSuccess() {},\n    toData1() {\n      if (this.user.role == 1) {\n        this.$router.push(\"/role\");\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData2() {\n      if (this.user.role == 1 || this.user.role == 5) {\n        this.$router.push(\"/data\");\n      } else {\n        this.$message(\"抱歉！您没有此功能权限\");\n      }\n    },\n    toData3() {\n      this.$router.push(\"/file\");\n    },\n    toData4() {\n      this.dialogFormVisible = true;\n    },\n    toData5() {\n      this.$router.push(\"/china\");\n    },\n    toData6() {\n      this.$router.push(\"/menu\");\n    },\n    send() {\n      if (!this.chatUser) {\n        this.$message({ type: \"warning\", message: \"请选择聊天对象\" });\n        return;\n      }\n      if (!this.text) {\n        this.$message({ type: \"warning\", message: \"请输入内容\" });\n      } else {\n        if (typeof WebSocket == \"undefined\") {\n          console.log(\"您的浏览器不支持WebSocket\");\n        } else {\n          console.log(\"您的浏览器支持WebSocket\");\n          // 组装待发送的消息 json\n          // {\"from\": \"zhang\", \"to\": \"admin\", \"text\": \"聊天文本\"}\n          let message = {\n            from: this.user.username,\n            to: this.chatUser,\n            text: this.text,\n          };\n          socket.send(JSON.stringify(message)); // 将组装好的json发送给服务端，由服务端进行转发\n          this.messages.push({ user: this.user.username, text: this.text });\n          // 构建消息内容，本人消息\n          this.createContent(null, this.user.username, this.text);\n          this.text = \"\";\n        }\n      }\n    },\n    createContent(remoteUser, nowUser, text) {\n      // 这个方法是用来将 json的聊天消息数据转换成 html的。\n      let html;\n      // 当前用户消息\n      if (nowUser) {\n        // nowUser 表示是否显示当前用户发送的聊天消息，绿色气泡\n        html =\n          '<div class=\"el-row\" style=\"padding: 5px 0\">\\n' +\n          '  <div class=\"el-col el-col-22\" style=\"text-align: right; padding-right: 10px\">\\n' +\n          '    <div class=\"tip left\">' +\n          text +\n          \"</div>\\n\" +\n          \"  </div>\\n\" +\n          '  <div class=\"el-col el-col-2\">\\n' +\n          '  <span class=\"el-avatar el-avatar--circle\" style=\"height: 40px; width: 40px; line-height: 40px;\">\\n' +\n          '    <img src=\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\" style=\"object-fit: cover;\">\\n' +\n          \"  </span>\\n\" +\n          \"  </div>\\n\" +\n          \"</div>\";\n      } else if (remoteUser) {\n        // remoteUser表示远程用户聊天消息，蓝色的气泡\n        html =\n          '<div class=\"el-row\" style=\"padding: 5px 0\">\\n' +\n          '  <div class=\"el-col el-col-2\" style=\"text-align: right\">\\n' +\n          '  <span class=\"el-avatar el-avatar--circle\" style=\"height: 40px; width: 40px; line-height: 40px;\">\\n' +\n          '    <img src=\"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\" style=\"object-fit: cover;\">\\n' +\n          \"  </span>\\n\" +\n          \"  </div>\\n\" +\n          '  <div class=\"el-col el-col-22\" style=\"text-align: left; padding-left: 10px\">\\n' +\n          '    <div class=\"tip right\">' +\n          text +\n          \"</div>\\n\" +\n          \"  </div>\\n\" +\n          \"</div>\";\n      }\n      console.log(html);\n      this.content += html;\n    },\n    init() {\n      this.user = localStorage.getItem(\"user\")\n        ? JSON.parse(localStorage.getItem(\"user\"))\n        : {};\n      let username = this.user.username;\n      let _this = this;\n      if (typeof WebSocket == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\");\n        let socketUrl = \"ws://localhost:9090/imserver/\" + username;\n        if (socket != null) {\n          socket.close();\n          socket = null;\n        }\n        // 开启一个websocket服务\n        socket = new WebSocket(socketUrl);\n        //打开事件\n        socket.onopen = function () {\n          console.log(\"websocket已打开\");\n        };\n        //  浏览器端收消息，获得从服务端发送过来的文本消息\n        socket.onmessage = function (msg) {\n          console.log(\"收到数据====\" + msg.data);\n          let data = JSON.parse(msg.data); // 对收到的json数据进行解析， 类似这样的： {\"users\": [{\"username\": \"zhang\"},{ \"username\": \"admin\"}]}\n          if (data.users) {\n            // 获取在线人员信息\n\n            _this.users = data.users.filter(\n              (user) => user.username !== username\n            );\n            // 获取当前连接的所有用户信息，并且排除自身，自己不会出现在自己的聊天列表里\n          } else {\n            // 如果服务器端发送过来的json数据 不包含 users 这个key，那么发送过来的就是聊天文本json数据\n            //  // {\"from\": \"zhang\", \"text\": \"hello\"}\n            if (data.from === _this.chatUser) {\n              _this.messages.push(data);\n              // 构建消息内容\n              _this.createContent(data.from, null, data.text);\n            }\n          }\n        };\n        //关闭事件\n        socket.onclose = function () {\n          console.log(\"websocket已关闭\");\n        };\n        //发生了错误事件\n        socket.onerror = function () {\n          console.log(\"websocket发生了错误\");\n        };\n      }\n    },\n  },\n};\n</script>\n\n<style >\n.tip {\n  color: white;\n  text-align: center;\n  border-radius: 10px;\n  font-family: sans-serif;\n  padding: 10px;\n  width: auto;\n  display: inline-block !important;\n  display: inline;\n}\n.right {\n  background-color: deepskyblue;\n}\n.left {\n  background-color: forestgreen;\n}\n.el-textarea_inner {\n  resize: none;\n}\n</style>"]},"metadata":{},"sourceType":"module"}